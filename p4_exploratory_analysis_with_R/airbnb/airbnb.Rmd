TITLE by YOUR_NAME_HERE
========================================================

> **Tip**: You will see quoted sections like this throughout the template to
help you construct your report. Make sure that you remove these notes before
you finish and submit your project!

> **Tip**: One of the requirements of this project is that your code follows
good formatting techniques, including limiting your lines to 80 characters or
less. If you're using RStudio, go into Preferences \> Code \> Display to set up
a margin line to help you keep track of this guideline!

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(tidyr)
library(dplyr)
library(scales)
library(gridExtra)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
airbnb = read.csv('data/airbnb_union.csv')
```

> **Tip**: [{remove}] Before you create any plots, it is a good idea to provide a short
introduction into the dataset that you are planning to explore. Replace this
quoted text with that general information![{/remove}]

The dataset I have chosen consists of airbnb data from San Francisco collected 
at [{X}] different dates between [{Month}]2013 and July 2017. I originally 
downloaded the datasets from [{URL}] as [{count}] individual files, which I then 
combined into a single file. For more details on this, see [{filename}].

For details on the content of the columns, see 
http://tomslee.net/airbnb-data-collection-get-the-data.

# Univariate Plots Section

> **Tip**: In this section, you should perform some preliminary exploration of
your dataset. Run some summaries of the data and create univariate plots to
understand the structure of the individual variables in your dataset. Don't
forget to add a comment after each plot or closely-related group of plots!
There should be multiple code chunks and text sections; the first one below is
just to help you get started.

I'll start my analysis by taking a look at some records to get an initial feel of the 
dataset.
```{r echo=FALSE, Univariate_Plots}
#Getting an initital look at some rows
head(airbnb)
```
```{r echo=FALSE, Univariate_Plots}
#Getting an initital look at some rows
tail(airbnb)
```

Next I'll get some information about the data types.

```{r echo=FALSE, Univariate_Plots}
str(airbnb)
```

```{r}
#Setting correct format for dates
airbnb$date_collected <- as.Date(airbnb$date_collected)
```

I now want to get some summary statistics for the different fields in the 
dataframe. 

```{r}
summary(airbnb)
```

I am already seeing some trends in the data. For example, based on the 1st 
quartile and max value for overall_satisfication, I suspect that very few 
listings have ratings below 4 of 5. Let's plot this to take a closer look.

```{r echo=FALSE, Univariate_Plots}

data = airbnb

plot = ggplot(data, aes(x = overall_satisfaction, fill = I('#099DD9') ) ) +
  geom_bar() +
  scale_x_continuous(breaks = seq(0,5,1)) +
  geom_text(stat='count',aes(
    label=scales::percent(..count../sum(..count..)),vjust=-0.5))

bar_plot

```

The plot confirms my suspicion: 81.9% of the ratings are 4 or higher, with more 
than 50% of the ratings being 5. However, it is interesting to see that 16.8% of 
the rooms have a rating of 0. Let's take a closer look at some summary statistics
for these records to see if there's a data quality issue.

```{r}
airbnb %>% 
  filter(overall_satisfaction==0) %>% 
  summary()
```
The first thing I notice is that there seem to be a large amount of records 
with 0 reviews. According to the dataset description the overall_satisfaction 
consists of " The average rating (out of five) that the listing has received from 
those visitors who left a review." We can therefore assume that records with 0 
reviews should have rating set to NA, not 0-5. Let's take a look at how many 
records have 0 reviews and an overall_satisfaction between 0 and 5.

```{r}
airbnb %>% 
  filter(reviews == 0 & !is.na(overall_satisfaction)) %>% 
  nrow()

```

About 8% of the records match this criteria. Let's plot the overall_satisfaction 
for these records.

```{r echo=FALSE, Univariate_Plots}
data = filter(airbnb, reviews == 0 & !is.na(overall_satisfaction))

plot = ggplot(data, aes(x = overall_satisfaction, fill = I('#099DD9') ) ) +
  geom_bar() +
  scale_x_continuous(breaks = seq(0,5,1)) +
  geom_text(stat='count',aes(
    label=scales::percent(..count../sum(..count..)),vjust=-0.5))

plot

```

It looks like all 0 reviews records with a value in overall_satisfaction has it 
set to 0. I'll run a filtered querry to make sure.

```{r}
airbnb %>% 
  filter(reviews == 0 & overall_satisfaction > 0)
```

3 out of 205k records is practically 0. I will now plot the overall_satisfaction 
column again excluding the 0 reviews records.

```{r}

plot = ggplot(filter(airbnb, reviews != 0), aes(x = overall_satisfaction, fill = I('#099DD9') ) ) +
  geom_bar() +
  scale_x_continuous(breaks = seq(0,5,1)) +
  geom_text(stat='count',aes(
    label=scales::percent(..count../sum(..count..)),vjust=-0.5))

plot
```
When excluding the zero reviews records, the percentage of records with an 
overall ranking of 0 goes down to 7.5. That's still a fair amount, but it's much 
more believeable than before. Let's run a summary query on these recorfs to see 
if we can spot any trends.

```{r}
airbnb %>% 
  filter(overall_satisfaction==0, reviews != 0) %>% 
  summary()
```

What stands out to me is that a large portion of these records have only one 
review. Let's compare the distribution of the amount of reviews of these records 
with the full sample[].

```{r}

p1 = ggplot(filter(airbnb, overall_satisfaction == 0 & reviews != 0), aes(x = reviews, fill = I('#099DD9') ) ) +
  geom_bar() +
#  scale_x_continuous(breaks = seq(0,5,1)) +
  geom_text(stat='count',aes(
    label=scales::percent(..count../sum(..count..)),vjust=-0.5))

p2 = ggplot(filter(airbnb, reviews != 0), aes(x = reviews, fill = I('#099DD9') ) ) +
  geom_histogram(binwidth = 5) +
  xlim(0,200)
# scale_x_continuous(limits = (0,200))
  #geom_text(stat='count',aes(
  #  label=scales::percent(..count../sum(..count..)),vjust=-0.5))

grid.arrange(p1,p2,nrow = 1)

```
[]noe her[]

Next let's take a look at the price distribution.

```{r}
plot = ggplot(airbnb, aes(x = price, fill = I('#099DD9') ) ) +
  geom_bar()# +
#  scale_x_continuous(breaks = seq(0,max(airbnb$price),1000))

plot
```

Looks like there's some extreme outliers for the price variable. Let's zoom in 
to get a better sense of price distribution

```{r}
plot = ggplot(airbnb, aes(x = price, fill = I('#099DD9') ) ) +
  geom_histogram(binwidth = 10) +
  xlim(0,1000)
#  scale_x_continuous(breaks = seq(0,max(airbnb$price),1000))

plot
```
[something something]



```{r}
quantile(airbnb$price, probs = seq(0,1,0.01)) %>% 
  grid.table()
```

I suspect size of the units heavily affect price. Therefore I will make a couple 
extra variables to look at the prices at the same room levels[].

```{r}
airbnb$price_per_bedroom = airbnb$price / airbnb$bedrooms

#Removing infinite values
is.na(airbnb$price_per_bedroom) <- do.call(cbind,lapply(airbnb$price_per_bedroom, is.infinite))

airbnb %>% 
  group_by(room_type) %>% 
  summarise(n = n(), avg_price = mean(price, na.rm = TRUE), 
            avg_bedroom_price = mean(price_per_bedroom, na.rm = TRUE))
```


```{r}
airbnb$room_type

airbnb %>% 
  group_by(room_type) %>% 
  summarise(n = n(), min_rooms = min(bedrooms, na.rm = TRUE), 
            max_rooms = max(bedrooms, na.rm = TRUE))

?summarise

max(airbnb$bedrooms, na.rm = TRUE)
```

```{r}
length((airbnb$date_collected))
min((airbnb$date_collected))
max((airbnb$date_collected))

?grid.table

```


```{r}
#minstay
plot = ggplot(airbnb, aes(x = minstay, fill = I('#099DD9') ) ) +
  geom_bar()

plot
```
```{r}
#zooming in on <100 days
plot = ggplot(subset(airbnb, minstay <=100), aes(x = minstay, fill = I('#099DD9') ) ) +
  geom_bar() + 
  scale_x_continuous(breaks = seq(0,100,10))

plot
```
```{r}
#zooming in on <10 days
plot = ggplot(subset(airbnb, minstay <=10), aes(x = minstay, fill = I('#099DD9') ) ) +
  geom_bar() + 
  scale_x_continuous(breaks = seq(0,10,1))

plot
```
The majority of listings have 1-3 days set as the minimum length of time for renting their unit. Almost no hosts asks for a longer
minimum stay than 7 days, although there is a small spike at 30 days, indicating that some units are 
listed as monthly rentals.

```{r}
#bedrooms
plot = ggplot(airbnb, aes(x = bedrooms, fill = I('#099DD9') ) ) +
  geom_bar() +
  scale_x_continuous(breaks = seq(0,max(subset(airbnb,!is.na(bedrooms))$bedrooms),1))

plot

```

```{r}
#accommodates
plot = ggplot(airbnb, aes(x = accommodates, fill = I('#099DD9') ) ) +
  geom_bar()
#  scale_x_continuous(breaks = seq(0,max(subset(airbnb,!is.na(bedrooms))$bedrooms),1))

plot
```

```{r}
#accommodates
plot = ggplot(airbnb, aes(x = accommodates, fill = I('#099DD9') ) ) +
  geom_bar()
#  scale_x_continuous(breaks = seq(0,max(subset(airbnb,!is.na(bedrooms))$bedrooms),1))

plot
```

> **Tip**: Make sure that you leave a blank line between the start / end of
each code block and the end / start of your Markdown text so that it is
formatted nicely in the knitted text. Note as well that text on consecutive
lines is treated as a single space. Make sure you have a blank line between
your paragraphs so that they too are formatted for easy readability.

# Univariate Analysis

> **Tip**: Now that you've completed your univariate explorations, it's time to
reflect on and summarize what you've found. Use the questions below to help you
gather your observations and add your own if you have other thoughts!

### What is the structure of your dataset?
There are 205,532 listings in the dataset. The listings were collected at 28 
different dates. between November 2013 and October 2017.


### What is/are the main feature(s) of interest in your dataset?

From my initial analysis I consider price and date to be the main features of 
interest in the data set. 

### What other features in the dataset do you think will help support your \
### investigation into your feature(s) of interest?
I believe number of bedrooms and room type are other interesting 
parameters which will greatly affect the price.

### Did you create any new variables from existing variables in the dataset?
Yes, I created price per bedroom, as that seemed to be the best indicator of 
size. Without taking unit size into account it is very hard to get a true price 
picture.

### Of the features you investigated, were there any unusual distributions? \
It is a little surprising to me how large the portion of 1 bedroom apartments is. 
More than half of the units on the market fit into this category. There's a chance 
some of these records really inform about the number of rooms available, not 
the actual amount of rooms in the unit. It will be interesting to later take a look at 
the bedroom distribution across room type.

### Did you perform any operations on the data to tidy, adjust, or change the form \
### of the data? If so, why did you do this?
Yes. I initially downloaded 28 separate files which I merged to one file using 
the tidy function union. For full details about this process, see [].
In the file you are reading now I have changed the data type of the date_collected 
column from factor to date, for easier handling later.

# Bivariate Plots Section

> **Tip**: Based on what you saw in the univariate plots, what relationships
between variables might be interesting to look at in this section? Don't limit
yourself to relationships between a main output feature and one of the
supporting variables. Try to look at relationships between supporting variables
as well.

In this section I'd like to take a closer look at the relationship between price 
and []. 

```{r echo=FALSE, Bivariate_Plots}

```

# Bivariate Analysis

> **Tip**: As before, summarize what you found in your bivariate explorations
here. Use the questions below to guide your discussion.

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

### What was the strongest relationship you found?


# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the \
strengths and limitations of your model.

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!